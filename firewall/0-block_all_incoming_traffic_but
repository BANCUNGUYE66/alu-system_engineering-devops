#!/usr/bin/env bash
# This script installs ufw and configures it to block all incoming traffic
# except for SSH (22), HTTP (80), and HTTPS (443).

# Exit immediately if a command exits with a non-zero status
set -e

echo "--- Updating system packages and installing ufw ---"
apt-get update -y
apt-get install -y ufw

# --- 1. Set Default Policy ---
# Deny all incoming traffic by default
echo "Setting default policy: Deny Incoming, Allow Outgoing"
ufw default deny incoming
ufw default allow outgoing

# --- 2. Allow Required Ports (TCP) ---
echo "Allowing essential TCP ports: 22 (SSH), 80 (HTTP), 443 (HTTPS)"

# Allow SSH access
ufw allow 22/tcp

# Allow HTTP access
ufw allow 80/tcp

# Allow HTTPS/SSL access
ufw allow 443/tcp

# --- 3. Enable Firewall ---
echo "Enabling ufw firewall"
# The 'y' flag ensures the script proceeds without hanging on the prompt
yes | ufw enable

echo "Firewall configured successfully. Status:"
ufw status verbose
