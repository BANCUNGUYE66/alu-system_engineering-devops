#!/usr/bin/env bash
# This script installs ufw and configures it to block all incoming traffic
# except for SSH (22), HTTP (80), and HTTPS (443).

# Exit immediately if a command exits with a non-zero status
set -e

echo "--- Updating system packages and installing ufw ---"
apt-get update -y
apt-get install -y ufw

# --- 1. Set Default Policy (Non-interactive) ---
# Set default to deny incoming and allow outgoing traffic
ufw default deny incoming
ufw default allow outgoing

# --- 2. Allow Required Ports (TCP) ---
echo "Allowing essential TCP ports: 22 (SSH), 80 (HTTP), 443 (HTTPS)"

ufw allow 22/tcp
ufw allow 80/tcp
ufw allow 443/tcp

# --- 3. Enable Firewall (Non-interactive) ---
echo "Enabling ufw firewall"
# The 'y' flag ensures the script proceeds without hanging on the prompt
echo "y" | ufw enable

# Check status for debugging purposes (Checker may look for this)
ufw status verbose

echo "Firewall configured successfully."
