#!/usr/bin/env bash
# This script modifies the Nginx configuration to run the worker process as the 'nginx' user
# and changes the listening port to 8080, then restarts Nginx.

# 1. Change the worker user from 'root' or 'www-data' to 'nginx'
# We use a sed command to replace the line starting with 'user'
# This is typically the default user setting in nginx.conf
sed -i 's/user www-data;/user nginx;/g' /etc/nginx/nginx.conf
sed -i 's/user nginx;/user nginx;/g' /etc/nginx/nginx.conf

# 2. Change the default listening port from 80 to 8080
# We use sed to replace 'listen 80' with 'listen 8080' in the sites-enabled default config.
sed -i 's/listen 80 default_server;/listen 8080 default_server;/g' /etc/nginx/sites-enabled/default
sed -i 's/listen \[::\]:80 default_server;/listen \[::\]:8080 default_server;/g' /etc/nginx/sites-enabled/default

# 3. Stop the existing (possibly root-owned) Nginx process
service nginx stop

# 4. Start Nginx (This will reload the configuration with user 'nginx' and port 8080)
service nginx start
